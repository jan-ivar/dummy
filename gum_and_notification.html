<html>
<meta charset=utf-8>
<video id="video" width="320" height="200" autoplay muted></video><br>
<button id="button">Join meeting (not really)</button>
<div id="div" style="white-space: pre;"></div>
<script>
const console = {log: msg => div.innerHTML += `${msg}<br>`};
const wait = ms => new Promise(resolve => setTimeout(resolve, ms));

button.onclick = async () => {
  try {
    const [stream, perm] = await Promise.all([
      navigator.mediaDevices.getUserMedia({video: true, audio: true}),
      navigator.permissions.query({name: "notifications"})
    ]);
    video.srcObject = stream;
    console.log(`notification query: ${perm.state}`);
    perm.onchange = () => console.log("onchange!");

    let notification = new Notification("Hi there!");
    await wait(5000);
    notification = new Notification("Am I bugging you?");
  } catch(e) {
    console.log(e);
  }
};
</script>
</html>
