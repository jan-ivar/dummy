<html>
<meta charset=utf-8>
<button id="button">navigator.geolocation.getCurrentPosition</button>
<geolocation id="geolocation"></geolocation>
<div id="div"></div>
<script>
const console = {log: msg => div.innerHTML += `${msg}<br>`};

button.onclick = async () => {
  try {
    const {coords} = await new Promise((r, e) => navigator.geolocation.getCurrentPosition(r, e));
    const {latitude, longitude, accuracy} = coords;
    console.log(`Your current position is ${latitude} x ${longitude} ± ${accuracy} meters.`);
  } catch (e) {
    console.log(`${e.name || "Error " + e.code}: ${e.message}`);
  }
  await dumpState();
};

geolocation.onlocation = () => {
  try {
    if (geolocation.error) throw geolocation.error;
    const {latitude, longitude, accuracy} = geolocation.position.coords;
    console.log(`Your current position is ${latitude} x ${longitude} ± ${accuracy} meters.`);
  } catch (e) {
    console.log(`${e.name || "Error " + e.code}: ${e.message}`);
  }
  dumpState();
};

async function dumpState() {
  if (navigator.permissions?.query) {
    const {state} = await navigator.permissions.query({name: "geolocation"});
    console.log(`geolocation permission: ${state}`);
  }
}
dumpState();

</script>
</html>
